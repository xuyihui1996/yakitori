# ç”¨æˆ·èº«ä»½è®°å¿†æœºåˆ¶è¯´æ˜

## ğŸ” å½“å‰å®ç°æ–¹å¼

### å­˜å‚¨æ–¹å¼ï¼šlocalStorage

**ä¸æ˜¯ä½¿ç”¨ UUID**ï¼Œè€Œæ˜¯ä½¿ç”¨ï¼š
1. **ç”¨æˆ·ID** - å­˜å‚¨åœ¨ `localStorage.getItem('ordered_user_id')`
2. **ç»„ID** - å­˜å‚¨åœ¨ `localStorage.getItem('ordered_group_id')`

### èº«ä»½è®°å¿†æµç¨‹

#### ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼ˆåˆ›å»ºæˆ–åŠ å…¥ç»„ï¼‰

```javascript
// 1. ç”¨æˆ·åˆ›å»ºç»„æˆ–åŠ å…¥ç»„
createGroup('å°æ˜')  // æˆ– joinGroup('G123456', 'å°æ˜')

// 2. ç³»ç»Ÿè‡ªåŠ¨ä¿å­˜åˆ° localStorage
localStorage.setItem('ordered_user_id', 'U1762032289088_zge6z90ll');
localStorage.setItem('ordered_group_id', 'G123456');
```

#### åˆ·æ–°æµè§ˆå™¨å

```javascript
// App.tsx ä¸­çš„æ¢å¤é€»è¾‘
const userId = localStorage.getItem('ordered_user_id');  // è¯»å–ä¿å­˜çš„ç”¨æˆ·ID
const groupId = localStorage.getItem('ordered_group_id');  // è¯»å–ä¿å­˜çš„ç»„ID

// ä» Supabase åŠ è½½ç”¨æˆ·ä¿¡æ¯
const user = await getUser(userId);

// åŠ è½½ç»„ä¿¡æ¯
await loadGroup(groupId);
```

### ä¼˜ç‚¹

âœ… **ç®€å•ç›´æ¥**ï¼šä½¿ç”¨æµè§ˆå™¨å†…ç½®å­˜å‚¨  
âœ… **è‡ªåŠ¨æŒä¹…åŒ–**ï¼šåˆ·æ–°ä¸ä¸¢å¤±  
âœ… **è·¨æ ‡ç­¾é¡µå…±äº«**ï¼šåŒä¸€åŸŸåä¸‹å…±äº«  

### é™åˆ¶

âš ï¸ **æ¸…é™¤æµè§ˆå™¨æ•°æ®ä¼šä¸¢å¤±**ï¼šæ¸…é™¤ç¼“å­˜/æœ¬åœ°æ•°æ®ä¼šä¸¢å¤±  
âš ï¸ **ä¸åŒè®¾å¤‡ä¸å…±äº«**ï¼šåªèƒ½åœ¨åŒä¸€ä¸ªæµè§ˆå™¨/è®¾å¤‡ä¸Šä½¿ç”¨  
âš ï¸ **éšç§æ¨¡å¼ä¼šä¸¢å¤±**ï¼šå…³é—­éšç§çª—å£åä¸¢å¤±  

## ğŸ†” ç”¨æˆ·IDç”Ÿæˆæ–¹å¼

### å½“å‰å®ç°

```typescript
// src/api/supabaseService.ts - createUser()
const userId = generateUniqueId('U');
// æ ¼å¼ï¼šU{timestamp}_{random}

// ä¾‹å¦‚ï¼šU1762032289088_zge6z90ll
// U = å‰ç¼€
// 1762032289088 = æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
// zge6z90ll = éšæœºå­—ç¬¦ä¸²ï¼ˆ9ä½ï¼‰
```

### ID ç‰¹ç‚¹

- **å”¯ä¸€æ€§**ï¼šæ—¶é—´æˆ³ + éšæœºå­—ç¬¦ä¸²ä¿è¯å”¯ä¸€
- **å¯è¿½æº¯**ï¼šå¯ä»¥é€šè¿‡æ—¶é—´æˆ³çŸ¥é“åˆ›å»ºæ—¶é—´
- **ä¸æ˜¯ UUID**ï¼šæ ¼å¼ä¸º `U{timestamp}_{random}`

## ğŸ”„ å¦‚ä½•æ¸…é™¤èº«ä»½

### æ–¹æ³• 1ï¼šæ‰‹åŠ¨æ¸…é™¤ï¼ˆå¼€å‘è€…ï¼‰

```javascript
// æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
localStorage.removeItem('ordered_user_id');
localStorage.removeItem('ordered_group_id');
window.location.reload();
```

### æ–¹æ³• 2ï¼šä»£ç æ¸…é™¤

å·²åœ¨ç»“è´¦ç•Œé¢æ·»åŠ "åˆ›å»ºæ–°æ¡Œ / åŠ å…¥æ–°æ¡Œ"æŒ‰é’®ï¼Œä¼šè‡ªåŠ¨æ¸…é™¤ç»„IDã€‚

### æ–¹æ³• 3ï¼šæ¸…é™¤æ‰€æœ‰æµè§ˆå™¨æ•°æ®

æµè§ˆå™¨è®¾ç½® â†’ æ¸…é™¤æµè§ˆæ•°æ® â†’ æ¸…é™¤ localStorage

## ğŸ“± ç§»åŠ¨è®¾å¤‡è€ƒè™‘

### å½“å‰æ–¹æ¡ˆï¼ˆlocalStorageï¼‰

- âœ… æ”¯æŒç§»åŠ¨æµè§ˆå™¨
- âœ… æ— éœ€é¢å¤–æƒé™
- âš ï¸ ä¸åŒåº”ç”¨å®ä¾‹ä¸å…±äº«ï¼ˆå¾®ä¿¡å°ç¨‹åº vs æµè§ˆå™¨ï¼‰

### å¯é€‰æ”¹è¿›æ–¹æ¡ˆ

å¦‚æœéœ€è¦æ›´æŒä¹…çš„èº«ä»½ï¼š

#### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ Cookie + æœåŠ¡ç«¯ Session

```typescript
// æœåŠ¡ç«¯ç”Ÿæˆ session
const sessionId = generateUUID();
// ä¿å­˜åˆ° cookie
document.cookie = `session_id=${sessionId}; max-age=604800`; // 7å¤©
```

#### æ–¹æ¡ˆ 2ï¼šä½¿ç”¨è®¾å¤‡æŒ‡çº¹

```typescript
// ç”Ÿæˆè®¾å¤‡æŒ‡çº¹
function getDeviceFingerprint(): string {
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  ctx.textBaseline = 'top';
  ctx.font = '14px Arial';
  ctx.fillText('Device fingerprint', 2, 2);
  
  const fingerprint = canvas.toDataURL();
  // ç»“åˆå…¶ä»–è®¾å¤‡ä¿¡æ¯
  const combined = fingerprint + navigator.userAgent + screen.width + screen.height;
  return hash(combined); // ç”Ÿæˆå“ˆå¸Œå€¼
}
```

#### æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ Supabase Auth

```typescript
// ä½¿ç”¨ Supabase è®¤è¯ç³»ç»Ÿ
import { supabase } from './supabaseClient';

// åŒ¿åç™»å½•
const { data, error } = await supabase.auth.signInAnonymously();
// ä¼šç”ŸæˆæŒä¹…çš„ session
```

## ğŸ’¡ æ¨èæ–¹æ¡ˆï¼ˆæ ¹æ®éœ€æ±‚ï¼‰

### å¦‚æœåªæ˜¯ç®€å•åœºæ™¯

**ä¿æŒå½“å‰ localStorage æ–¹æ¡ˆ**ï¼š
- âœ… ç®€å•æ˜“ç”¨
- âœ… æ— éœ€é¢å¤–é…ç½®
- âœ… é€‚åˆä¸´æ—¶ä½¿ç”¨åœºæ™¯

### å¦‚æœéœ€è¦æŒä¹…èº«ä»½

**åˆ‡æ¢åˆ° Supabase Auth**ï¼š
- âœ… æ”¯æŒåŒ¿åç™»å½•
- âœ… è·¨è®¾å¤‡åŒæ­¥ï¼ˆå¦‚æœç”¨åŒä¸€è´¦å·ï¼‰
- âœ… è‡ªåŠ¨è¿‡æœŸç®¡ç†

### å¦‚æœéœ€è¦æ›´å¼ºéšç§

**ä½¿ç”¨ä¸´æ—¶ ID + è¿‡æœŸæœºåˆ¶**ï¼š
- âœ… å®šæœŸæ¸…é™¤æ—§æ•°æ®
- âœ… ä¸å­˜å‚¨ä¸ªäººä¿¡æ¯
- âœ… ç¬¦åˆéšç§è¦æ±‚

## ğŸ”§ å½“å‰ä»£ç ä½ç½®

### èº«ä»½å­˜å‚¨
- `localStorage.setItem('ordered_user_id', userId)` - åˆ›å»ºç”¨æˆ·æ—¶
- `localStorage.getItem('ordered_user_id')` - æ¢å¤ç”¨æˆ·æ—¶

### èº«ä»½æ¢å¤
- `src/App.tsx` - åº”ç”¨å¯åŠ¨æ—¶æ¢å¤
- `src/pages/JoinGroup.tsx` - å·²æœ‰èº«ä»½æ—¶è‡ªåŠ¨è·³è½¬

### ç”¨æˆ·åˆ›å»º
- `src/api/supabaseService.ts` - `createUser()` å‡½æ•°

## ğŸ¯ æ€»ç»“

**å½“å‰æœºåˆ¶**ï¼š
- âœ… ä½¿ç”¨ **localStorage** å­˜å‚¨ç”¨æˆ·IDå’Œç»„ID
- âœ… åˆ·æ–°åè‡ªåŠ¨æ¢å¤èº«ä»½
- âœ… ç”¨æˆ·IDæ ¼å¼ï¼š`U{timestamp}_{random}`ï¼ˆä¸æ˜¯æ ‡å‡†UUIDï¼‰
- âš ï¸ æ¸…é™¤æµè§ˆå™¨æ•°æ®ä¼šä¸¢å¤±èº«ä»½

**å¦‚éœ€æ”¹è¿›**ï¼š
- å¯ä»¥åˆ‡æ¢åˆ° Supabase Auth
- æˆ–æ·»åŠ  Cookie æŒä¹…åŒ–
- æˆ–æ·»åŠ è®¾å¤‡æŒ‡çº¹è¯†åˆ«

**å¯¹äºæ‚¨çš„åœºæ™¯**ï¼š
- ä¸´æ—¶ä½¿ç”¨ï¼šå½“å‰æ–¹æ¡ˆè¶³å¤Ÿ âœ…
- éœ€è¦æŒä¹…åŒ–ï¼šå»ºè®®ä½¿ç”¨ Supabase Auth â­

