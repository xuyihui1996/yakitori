# 🔧 故障排查指南

## 问题：页面空白

### 症状
- 访问 `http://localhost:5173/`
- 页面完全空白
- 没有任何内容显示

### 可能原因

#### 1. ❌ 切换到 Supabase 但未配置环境变量

**检查方式**：
```bash
# 查看 groupStore.ts 第 15 行
cat src/store/groupStore.ts | grep "import.*api"

# 如果显示：import * as api from '@/api/supabaseService';
# 说明已切换到 Supabase

# 检查环境变量
cat .env.local
```

**解决方案**：

方案 A：**切换回 Mock 服务**（立即可用）
```typescript
// src/store/groupStore.ts 第 15 行
import * as api from '@/api/mockService';  // 使用这个
```

方案 B：**配置 Supabase 环境变量**
1. 创建 `.env.local` 文件
2. 添加配置（见下方）
3. 重启开发服务器

#### 2. ❌ 开发服务器未启动

**检查方式**：
```bash
# 查看是否有 Vite 进程
ps aux | grep vite
```

**解决方案**：
```bash
# 启动开发服务器
npm run dev
```

#### 3. ❌ 浏览器缓存问题

**解决方案**：
- 按 `Ctrl + Shift + R`（强制刷新）
- 或清除浏览器缓存
- 或打开隐私模式重新访问

#### 4. ❌ 构建错误

**检查方式**：
```bash
# 查看终端输出
# 看是否有红色错误信息
```

**解决方案**：
```bash
# 重新安装依赖
rm -rf node_modules package-lock.json
npm install

# 重新启动
npm run dev
```

---

## 🔍 浏览器控制台检查

打开浏览器控制台（F12），查看错误信息：

### 常见错误 1：Supabase 连接失败
```
Error: Supabase credentials not found
```

**原因**：未配置 `.env.local`  
**解决**：创建并配置环境变量文件

### 常见错误 2：找不到模块
```
Cannot find module '@/api/supabaseService'
```

**原因**：文件路径问题或依赖未安装  
**解决**：
```bash
npm install @supabase/supabase-js
```

### 常见错误 3：CORS 错误
```
Access to fetch ... has been blocked by CORS policy
```

**原因**：Supabase 配置问题  
**解决**：检查 Supabase 项目的 API 设置

---

## ✅ 正确的 Supabase 配置流程

### 1. 获取 Supabase 凭据

登录 [supabase.com](https://supabase.com)：

1. 选择您的项目
2. 点击左侧 **Settings ⚙️**
3. 选择 **API**
4. 复制两个值：
   - **Project URL**（例如：`https://xxxxx.supabase.co`）
   - **anon public** key（一长串字符）

### 2. 创建 `.env.local` 文件

在项目根目录创建文件：

```bash
# .env.local
VITE_SUPABASE_URL=https://你的项目ID.supabase.co
VITE_SUPABASE_ANON_KEY=你的anon_public_key
```

⚠️ **注意**：
- 不要有引号
- 不要有空格
- 确保以 `VITE_` 开头

### 3. 切换到 Supabase 服务

编辑 `src/store/groupStore.ts`：

```typescript
// 第 15 行
import * as api from '@/api/supabaseService';
```

### 4. 重启开发服务器

**重要**：环境变量更改后必须重启！

```bash
# 停止当前服务器（Ctrl + C）
# 重新启动
npm run dev
```

### 5. 测试连接

打开浏览器控制台，应该看到：

```
✅ Supabase connected successfully
```

---

## 🎯 快速诊断流程

### 步骤 1：确认使用的服务

```bash
grep "import.*api.*from" src/store/groupStore.ts
```

- 如果是 `mockService` → Mock 数据（无需配置）
- 如果是 `supabaseService` → 需要配置 Supabase

### 步骤 2：检查环境变量（仅 Supabase）

```bash
cat .env.local
```

- 如果文件不存在 → 创建它
- 如果内容为空或错误 → 更新为正确的值

### 步骤 3：重启服务器

```bash
# 停止：Ctrl + C
# 启动：
npm run dev
```

### 步骤 4：清除浏览器缓存

按 `Ctrl + Shift + R` 强制刷新

### 步骤 5：检查浏览器控制台

按 `F12`，查看 Console 标签页：
- ✅ 没有错误 → 成功
- ❌ 有红色错误 → 根据错误信息修复

---

## 📞 仍然无法解决？

### 检查清单

- [ ] 开发服务器是否运行？
- [ ] 浏览器控制台有什么错误？
- [ ] 使用的是 mockService 还是 supabaseService？
- [ ] 如果是 Supabase，.env.local 是否正确？
- [ ] 是否重启了开发服务器？
- [ ] 是否清除了浏览器缓存？

### 提供以下信息

1. 终端输出（npm run dev 的结果）
2. 浏览器控制台的错误信息
3. 使用的是哪个服务（Mock 还是 Supabase）
4. 是否配置了 .env.local

---

## 🚀 推荐方案

### 对于新手：先用 Mock 服务

```typescript
// src/store/groupStore.ts
import * as api from '@/api/mockService';
```

**优点**：
- ✅ 无需配置
- ✅ 立即可用
- ✅ 适合学习和测试

**缺点**：
- ❌ 数据不持久化
- ❌ 无法多人协作

### 对于生产：使用 Supabase

完整配置步骤见上方"正确的 Supabase 配置流程"。

**优点**：
- ✅ 数据持久化
- ✅ 支持多人协作
- ✅ 真实生产环境

**缺点**：
- ⚠️ 需要配置
- ⚠️ 需要网络连接

---

**建议**：先用 Mock 服务把项目跑起来，熟悉功能后再切换到 Supabase。

