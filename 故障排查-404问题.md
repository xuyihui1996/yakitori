# ğŸ” API 404 é”™è¯¯æ’æŸ¥

## é—®é¢˜ç—‡çŠ¶

1. âŒ `Failed to load resource: 404 (Not Found)` - `/api/parse-menu`
2. âŒ `Failed to execute 'text' on 'Response': body stream already read`

## åŸå› åˆ†æ

### é—®é¢˜ 1: API 404

Vercel Dev æ²¡æœ‰æ­£ç¡®è¯†åˆ« API è·¯ç”±ã€‚å¯èƒ½åŸå› ï¼š
- API æ–‡ä»¶ä½ç½®ä¸å¯¹
- vercel.json é…ç½®é—®é¢˜
- Vercel Dev ç¼“å­˜é—®é¢˜

### é—®é¢˜ 2: Body Stream Already Read

å‰ç«¯é”™è¯¯å¤„ç†ä»£ç å¤šæ¬¡è¯»å–åŒä¸€ä¸ª Response å¯¹è±¡çš„ bodyã€‚

## è§£å†³æ–¹æ¡ˆ

### âœ… å·²ä¿®å¤

1. **ä¿®å¤äº† Response body é‡å¤è¯»å–é—®é¢˜**
   - ä½¿ç”¨ `response.clone()` é¿å…é‡å¤è¯»å–

2. **æ›´æ–°äº† vercel.json é…ç½®**
   - æ·»åŠ äº†æ˜ç¡®çš„ routes é…ç½®

## ğŸ”§ å®Œæ•´æ’æŸ¥æ­¥éª¤

### æ­¥éª¤ 1: æ£€æŸ¥ API æ–‡ä»¶æ˜¯å¦å­˜åœ¨

```bash
ls -la api/
# åº”è¯¥çœ‹åˆ°: parse-menu.ts
```

### æ­¥éª¤ 2: æ¸…é™¤ Vercel ç¼“å­˜å¹¶é‡å¯

```bash
# åœæ­¢ vercel dev (Ctrl+C)

# æ¸…é™¤ Vercel ç¼“å­˜
rm -rf .vercel

# é‡æ–°ç™»å½•ï¼ˆå¯é€‰ï¼‰
vercel logout
vercel login

# è®¾ç½®ç¯å¢ƒå˜é‡
export GOOGLE_APPLICATION_CREDENTIALS=$(pwd)/yakitori-477003-94640fab8889.json

# é‡æ–°å¯åŠ¨
vercel dev
```

### æ­¥éª¤ 3: æ£€æŸ¥ Vercel Dev è¾“å‡º

å¯åŠ¨ååº”è¯¥çœ‹åˆ°ï¼š
```
Vercel CLI 28.x.x
> Ready! Available at http://localhost:3000
```

åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…· Network æ ‡ç­¾ä¸­ï¼Œæ£€æŸ¥ï¼š
- API è¯·æ±‚çš„ URL æ˜¯å¦æ­£ç¡®ï¼š`http://localhost:3000/api/parse-menu`
- è¯·æ±‚æ–¹æ³•æ˜¯å¦æ˜¯ POST
- å“åº”çŠ¶æ€ç 

### æ­¥éª¤ 4: ç›´æ¥æµ‹è¯• API ç«¯ç‚¹

åœ¨æ–°ç»ˆç«¯ä¸­ï¼š
```bash
# æµ‹è¯• API æ˜¯å¦å¯è®¿é—®
curl -X POST http://localhost:3000/api/parse-menu \
  -H "Content-Type: application/json" \
  -d '{"test": "data"}'

# åº”è¯¥è¿”å›é”™è¯¯ä¿¡æ¯ï¼ˆå› ä¸ºæ²¡æœ‰å‘é€å›¾ç‰‡ï¼‰ï¼Œä½†ä¸åº”è¯¥æ˜¯ 404
# é¢„æœŸ: {"error": "Invalid request body"...} æˆ–ç±»ä¼¼ä¿¡æ¯
```

## ğŸ’¡ æ›¿ä»£æµ‹è¯•æ–¹æ¡ˆ

å¦‚æœ Vercel Dev ä»ç„¶æœ‰é—®é¢˜ï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹æ¡ˆï¼š

### æ–¹æ¡ˆ A: ä½¿ç”¨æœ¬åœ° Node æœåŠ¡å™¨ï¼ˆæ¨èï¼‰

åˆ›å»ºä¸€ä¸ªç®€å•çš„æœ¬åœ°æµ‹è¯•æœåŠ¡å™¨ï¼š

```bash
# å®‰è£… expressï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
npm install express @types/express --save-dev

# åˆ›å»ºæµ‹è¯•æœåŠ¡å™¨
cat > test-server.js << 'EOF'
const express = require('express');
const app = express();
const handler = require('./api/parse-menu.ts').default;

app.post('/api/parse-menu', async (req, res) => {
  await handler(req, res);
});

app.listen(3000, () => {
  console.log('Test server running at http://localhost:3000');
});
EOF

# å¯åŠ¨
node test-server.js
```

### æ–¹æ¡ˆ B: ç›´æ¥éƒ¨ç½²åˆ° Vercel æµ‹è¯•

```bash
# 1. ç¡®ä¿ä»£ç å·²æäº¤
git add .
git commit -m "fix: ä¿®å¤ API é…ç½®å’Œé”™è¯¯å¤„ç†"
git push

# 2. åœ¨ Vercel Dashboard è®¾ç½®ç¯å¢ƒå˜é‡
# Settings â†’ Environment Variables
# Name: GOOGLE_APPLICATION_CREDENTIALS
# Value: [ç²˜è´´ JSON æ–‡ä»¶å†…å®¹]

# 3. ç­‰å¾…éƒ¨ç½²å®Œæˆååœ¨ç”Ÿäº§ç¯å¢ƒæµ‹è¯•
```

### æ–¹æ¡ˆ C: å…ˆç”¨å‘½ä»¤è¡Œæµ‹è¯• OCRï¼Œå‰ç«¯æš‚æ—¶ Mock

```bash
# 1. æµ‹è¯• OCR åŠŸèƒ½
export GOOGLE_APPLICATION_CREDENTIALS=$(pwd)/yakitori-477003-94640fab8889.json
npm run parse:menu "æˆªå›¾ 2025-11-02 14-51-50.png"

# 2. å¯åŠ¨å‰ç«¯ï¼ˆä¸ä¾èµ– APIï¼‰
npm run dev

# 3. æš‚æ—¶åœ¨å‰ç«¯ä½¿ç”¨ mock æ•°æ®æµ‹è¯• UI
```

## ğŸ” æ·±åº¦æ’æŸ¥

### æ£€æŸ¥ Vercel Dev é…ç½®

```bash
# æŸ¥çœ‹ Vercel é¡¹ç›®é…ç½®
cat .vercel/project.json 2>/dev/null || echo "No Vercel project linked"

# æ£€æŸ¥æ˜¯å¦é“¾æ¥äº†æ­£ç¡®çš„é¡¹ç›®
vercel whoami
vercel ls
```

### æ£€æŸ¥ç«¯å£å ç”¨

```bash
# æ£€æŸ¥ 3000 ç«¯å£æ˜¯å¦è¢«å ç”¨
lsof -i :3000

# å¦‚æœè¢«å ç”¨ï¼Œä½¿ç”¨å…¶ä»–ç«¯å£
vercel dev --listen 3001
```

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

```bash
# å¯åŠ¨æ—¶æ·»åŠ  debug æ ‡å¿—
vercel dev --debug
```

## âœ… æˆåŠŸçš„æ ‡å¿—

ä¿®å¤æˆåŠŸååº”è¯¥çœ‹åˆ°ï¼š

1. **ç»ˆç«¯ï¼ˆVercel Devï¼‰**:
   ```
   âœ… Environment variable set: YES
   ğŸ“¦ Parsing multipart/form-data...
   ğŸ“· Image file: menu.png
   ğŸ¤– Starting OCR processing...
   âœ… OCR completed: 10 items found
   ```

2. **æµè§ˆå™¨æ§åˆ¶å°**:
   - æ—  404 é”™è¯¯
   - æ—  "body stream already read" é”™è¯¯
   - è¯†åˆ«ç»“æœæ­£å¸¸æ˜¾ç¤º

3. **æµè§ˆå™¨ Network æ ‡ç­¾**:
   - `/api/parse-menu` è¿”å› 200 çŠ¶æ€
   - Response æ˜¯æœ‰æ•ˆçš„ JSON
   - åŒ…å« `items` æ•°ç»„

## ğŸ¯ æ¨èæ“ä½œ

**å¦‚æœé—®é¢˜å¤æ‚ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨æ–¹æ¡ˆ Bï¼ˆéƒ¨ç½²åˆ° Vercel ç”Ÿäº§ç¯å¢ƒï¼‰**

ä¼˜ç‚¹ï¼š
- âœ… ç¯å¢ƒé…ç½®æ›´å¯é 
- âœ… æ— æœ¬åœ°å¼€å‘ç¯å¢ƒé—®é¢˜
- âœ… å¯ä»¥å¿«é€ŸéªŒè¯åŠŸèƒ½
- âœ… æ›´æ¥è¿‘çœŸå®ä½¿ç”¨åœºæ™¯

æ­¥éª¤ï¼š
```bash
# 1. æäº¤ä»£ç 
git add .
git commit -m "fix: ä¿®å¤ API å’Œé”™è¯¯å¤„ç†"
git push

# 2. åœ¨ Vercel Dashboard è®¾ç½®ç¯å¢ƒå˜é‡
# 3. ç­‰å¾…éƒ¨ç½²å®Œæˆ
# 4. åœ¨ç”Ÿäº§ç¯å¢ƒæµ‹è¯•
```

---

**éœ€è¦å¸®åŠ©ï¼Ÿå‘Šè¯‰æˆ‘ä½ çš„é€‰æ‹©ï¼**

