# 测试旋转效果对比

## 🧪 测试计划

### 测试 A：无旋转（当前结果）
```bash
npm run parse:menu './截图 2025-11-02 12-48-38.png'
```

**预期**：
- 图片尺寸：1193 x 895 (横向)
- 列数：16 列 → 限制为 10 列
- 价格列：0 个
- 准确率：~10%

### 测试 B：启用旋转
```bash
npm run parse:menu './截图 2025-11-02 12-48-38.png' -- --rotate
```

**预期改进**：
- 图片尺寸：895 x 1193 (竖向) ✅
- 列间距阈值：35.8px → 26.8px ✅
- 列数：预计 10-12 列
- 价格列：预计 4-6 个 ✅
- 准确率：预计 30-50% ✅

### 测试 C：旋转 + 增强
```bash
npm run parse:menu './截图 2025-11-02 12-48-38.png' -- --rotate --enhance
```

**预期改进**：
- 在测试 B 基础上
- 文字边缘更清晰
- OCR 置信度提升

---

## 📊 对比维度

### 1. 图片尺寸

| 测试 | 宽 | 高 | 方向 | 列阈值 |
|-----|---|---|-----|--------|
| A (无旋转) | 1193 | 895 | 横 | 35.8px |
| B (旋转) | 895 | 1193 | 竖 | 26.8px ✅ |

### 2. 识别结果

| 测试 | Words | Items | 列数 | 价格列 | 准确率 |
|-----|-------|-------|------|--------|--------|
| A (无旋转) | 576 | 190 | 16→10 | 0 | ~10% |
| B (旋转) | ? | ? | ? | ? | ? |
| C (旋转+增强) | ? | ? | ? | ? | ? |

### 3. 价格识别

| 测试 | 识别到价格 | 识别正确 | 需要审核 |
|-----|----------|----------|----------|
| A (无旋转) | 10 | 10 | 94 |
| B (旋转) | ? | ? | ? |
| C (旋转+增强) | ? | ? | ? |

---

## 🎯 关键指标

### 成功标准

- ✅ 价格列识别数 > 0（当前为 0）
- ✅ 准确率 > 30%（当前 ~10%）
- ✅ 需要审核的项 < 50%（当前 90%）

### 理想目标

- 🌟 价格列识别数 >= 5
- 🌟 准确率 >= 50%
- 🌟 需要审核的项 < 30%

---

## 🔬 测试步骤

### 1. 备份当前结果
```bash
cp menu-output.json menu-output-baseline.json
```

### 2. 运行测试 B（旋转）
```bash
npm run parse:menu './截图 2025-11-02 12-48-38.png' -- --rotate > test-rotate.log 2>&1
cp menu-output.json menu-output-rotate.json
```

### 3. 对比结果
```bash
# 统计准确率
jq '[.[] | select(.needsReview == false and .price != null)] | length' menu-output-baseline.json
jq '[.[] | select(.needsReview == false and .price != null)] | length' menu-output-rotate.json

# 对比价格识别
jq '[.[] | select(.price != null) | {name, price}] | .[0:20]' menu-output-baseline.json
jq '[.[] | select(.price != null) | {name, price}] | .[0:20]' menu-output-rotate.json
```

---

## 📝 预期分析

### 场景 1：旋转效果显著

**表现**：
- 价格列从 0 → 5+
- 准确率从 10% → 40%+
- 列分组更合理

**原因**：
- Vision API 更好地理解竖排布局
- 阈值更适合竖排列间距
- X/Y 坐标更直观

**结论**：
✅ **立即在生产环境启用旋转**

### 场景 2：旋转效果一般

**表现**：
- 价格列从 0 → 1-2
- 准确率从 10% → 15-20%
- 列分组略有改善

**原因**：
- 菜单本身复杂度高
- 需要配合区域切分

**结论**：
⭐ **旋转 + 区域切分组合使用**

### 场景 3：旋转无明显效果

**表现**：
- 价格列仍为 0-1
- 准确率提升 < 5%

**原因**：
- 可能需要调整其他参数
- 或菜单拍摄角度/光线问题

**结论**：
🔧 **需要进一步调试和优化**

---

## 💡 下一步行动

根据测试 B 的结果：

### 如果效果好（准确率 > 30%）

1. ✅ 在生产代码中默认启用旋转
2. 📝 更新文档和使用说明
3. 🚀 考虑实施区域切分

### 如果效果一般（准确率 15-30%）

1. ⭐ 实施区域切分
2. 🔧 调整列分组阈值
3. 🧪 测试不同的旋转角度

### 如果效果不佳（准确率 < 15%）

1. 🔍 检查旋转后的图片质量
2. 🔧 调试列分类算法
3. 💡 考虑使用 Vision 的其他参数

---

## 📊 区域切分方案（如需实施）

### 根据你的菜单布局

```typescript
// 旋转后的坐标（895 x 1193）
const REGIONS = [
  {
    name: '串焼',
    x: 0,
    y: 0,
    width: 224,    // ~25%
    height: 1193,
  },
  {
    name: '揚物',
    x: 224,
    y: 0,
    width: 224,
    height: 1193,
  },
  {
    name: '飯物',
    x: 448,
    y: 0,
    width: 224,
    height: 1193,
  },
  {
    name: '一品物',
    x: 672,
    y: 0,
    width: 223,
    height: 1193,
  },
];
```

### 测试区域切分
```bash
# 先实现区域切分功能
npm run parse:menu './截图 2025-11-02 12-48-38.png' -- --rotate --split
```

---

## 🎯 总结

你的两个建议都非常有价值！

### 立即测试：
```bash
# 对比旋转效果
npm run parse:menu './截图 2025-11-02 12-48-38.png' -- --rotate
```

### 根据结果决定：
- ✅ 效果好 → 启用旋转
- ⭐ 效果一般 → 旋转 + 切分
- 🔧 效果不佳 → 深入调试

让我们先看看旋转的效果如何！🚀


